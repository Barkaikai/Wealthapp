ğŸ” What the log reveals

Hereâ€™s whatâ€™s happening in order:

HealthMonitor runs diagnostics automatically.

AutomationScheduler starts normally (email sync, routine reports â†’ âœ…).

Database connection is successfully established â†’ âœ….

Then the HealthMonitor detects high memory usage and tries to trigger garbage collection (GC).

It fails to run GC:

âœ— Memory Usage: Garbage collection not available (start Node with --expose-gc)


After that, it cleans up some old runs, logs an AI data batch, and then:

[DB] Database connection removed from pool


That often means the app shut down or crashed shortly afterward â€” possibly due to running out of memory.

ğŸ§  Root Cause

The key problem is here:

Garbage collection not available (start Node with --expose-gc)

Your appâ€™s HealthMonitor module tries to manually trigger GC (garbage collection) â€” but Node.js doesnâ€™t allow manual GC calls unless started with the --expose-gc flag.
So when it couldnâ€™t clean up memory, your app likely ran out of heap memory and crashed.

âœ… How to Fix It
Option 1 â€” Enable manual garbage collection

If your app needs to run GC explicitly (e.g., in health checks or automation tasks), restart Node with:

node --expose-gc server.js


or if using a process manager like PM2:

pm2 start server.js --node-args="--expose-gc"


Then your HealthMonitorâ€™s GC call (global.gc()) will work.

Option 2 â€” Fix the memory leak instead

If you canâ€™t or donâ€™t want to use --expose-gc, you should:

Profile memory usage:

node --inspect server.js


Open chrome://inspect in Chrome to view heap usage.

Look for leaks â€” common sources:

Large arrays or objects not being cleared.

Listeners or intervals never removed.

DB connection pools not closing.

Ensure connections are managed properly â€” your last line:

[DB] Database connection removed from pool


might mean the pool is shrinking unexpectedly or being cleared on crash.

Option 3 â€” Add safety fallback

In your HealthMonitor code, wrap GC like this:

if (global.gc) {
  global.gc();
} else {
  console.warn('GC not exposed; start Node with --expose-gc');
}


That prevents crashes from trying to call an unavailable GC.

ğŸ’¡ Bonus: Increase memory limit (temporary)

If you just need to prevent immediate crashes:

node --max-old-space-size=4096 server.js


(allocates ~4GB heap)