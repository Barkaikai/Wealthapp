Go to üîí Secrets in your Replit project and add:

MS_CLIENT_ID=689460ef-cda7-43a1-9810-b90bae9fc7aa
MS_TENANT_ID=2a7129e8-f71e-4acb-b54e-2779d48885db
MS_CLIENT_SECRET=<paste-your-client-secret>
MS_REDIRECT_URI=https://daily-brief-brinsonbarkai.replit.app/auth/microsoft/callback
REDIS_URL=<paste-your-redis-url>
APP_BASE_URL=https://daily-brief-brinsonbarkai.replit.app
CSRF_SECRET=7f9a2e4c8b1d6f3a5e7c9b2d4f6a8e1c


(Replace <paste-your-client-secret> and <paste-your-redis-url> with your real values.)

2Ô∏è‚É£ Paste this backend code into /backend/routes/authMicrosoft.js
const express = require("express");
const router = express.Router();
const msal = require("@azure/msal-node");

const msalConfig = {
  auth: {
    clientId: process.env.MS_CLIENT_ID,
    authority: `https://login.microsoftonline.com/${process.env.MS_TENANT_ID}`,
    clientSecret: process.env.MS_CLIENT_SECRET,
  },
};
const cca = new msal.ConfidentialClientApplication(msalConfig);

// Step 1: Redirect user to Microsoft login
router.get("/microsoft", async (req, res) => {
  const authUrl = await cca.getAuthCodeUrl({
    scopes: ["user.read","mail.read","files.readwrite","calendars.readwrite"],
    redirectUri: process.env.MS_REDIRECT_URI,
  });
  res.redirect(authUrl);
});

// Step 2: Handle callback
router.get("/microsoft/callback", async (req, res) => {
  try {
    const tokenResponse = await cca.acquireTokenByCode({
      code: req.query.code,
      scopes: ["user.read","mail.read","files.readwrite","calendars.readwrite"],
      redirectUri: process.env.MS_REDIRECT_URI,
    });
    // Save token/session in DB or cookie here
    res.send("Microsoft account connected successfully!");
  } catch (err) {
    console.error(err);
    res.status(500).send("Auth failed");
  }
});

module.exports = router;

3Ô∏è‚É£ Add this to your main Express server.js
const authMicrosoft = require("./routes/authMicrosoft");
app.use("/auth", authMicrosoft);

4Ô∏è‚É£ Frontend shortcut

Create a simple button anywhere in your app:

<a href="/auth/microsoft">
  Connect Microsoft Account
</a>


Clicking it opens Microsoft login ‚Üí callback ‚Üí account connected.